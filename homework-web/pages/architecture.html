<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linux 整体结构 - Linux 系统编程</title>
    <link rel="stylesheet" href="../css/main.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <span class="logo">🐧</span>
            <span class="title">Linux 系统编程</span>
        </div>
        <ul class="nav-links">
            <li><a href="../index.html">首页</a></li>
            <li><a href="linux-env.html">Linux环境</a></li>
            <li><a href="architecture.html" class="active">系统架构</a></li>
            <li><a href="c-programming.html">C语言</a></li>
            <li><a href="kernel.html">内核模块</a></li>
            <li><a href="android.html">安卓</a></li>
            <li><a href="quiz.html">测验</a></li>
        </ul>
    </nav>

    <main class="main-content">
        <div class="page-container">
            <header class="page-header">
                <h1><span class="icon">🏗️</span> Linux 整体结构</h1>
                <p class="breadcrumb"><a href="../index.html">首页</a> / Linux 整体结构</p>
            </header>

            <!-- 系统架构总览 -->
            <section class="content-section" id="overview">
                <h2 class="section-title">
                    <span class="icon">📊</span>
                    系统架构总览
                </h2>

                <div class="diagram-container">
                    <h4>Linux 系统分层架构</h4>
                    <div class="arch-diagram">
                        <div class="arch-layer app-layer">
                            🖥️ 应用层 (Application Layer)
                            <div style="font-size: 0.85rem; font-weight: normal; margin-top: 0.5rem;">
                                用户程序、Shell 命令、浏览器、编辑器
                            </div>
                        </div>
                        <div class="arch-arrow">
                            ↕
                            <span class="label">调用库函数</span>
                        </div>
                        <div class="arch-layer lib-layer">
                            📚 系统库层 (Library Layer)
                            <div style="font-size: 0.85rem; font-weight: normal; margin-top: 0.5rem;">
                                glibc、libpthread、动态链接库
                            </div>
                        </div>
                        <div class="arch-arrow">
                            ↕
                            <span class="label">系统调用 (System Call)</span>
                        </div>
                        <div class="arch-layer kernel-layer">
                            ⚙️ 内核层 (Kernel Layer)
                            <div style="font-size: 0.85rem; font-weight: normal; margin-top: 0.5rem;">
                                进程管理 | 内存管理 | 文件系统 | 网络 | 驱动
                            </div>
                        </div>
                        <div class="arch-arrow">
                            ↕
                            <span class="label">硬件操作</span>
                        </div>
                        <div class="arch-layer hw-layer">
                            🔧 硬件层 (Hardware Layer)
                            <div style="font-size: 0.85rem; font-weight: normal; margin-top: 0.5rem;">
                                CPU | 内存 | 硬盘 | 网卡 | 其他设备
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 硬件层 -->
            <section class="content-section" id="hardware">
                <h2 class="section-title">
                    <span class="icon">🔧</span>
                    （1）硬件层
                </h2>

                <div class="card-grid">
                    <div class="feature-card">
                        <div class="icon">💻</div>
                        <h4>CPU</h4>
                        <p>执行指令的核心</p>
                        <ul style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem;">
                            <li>执行计算任务</li>
                            <li>运行进程指令</li>
                            <li>处理中断</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <div class="icon">🧠</div>
                        <h4>内存 (RAM)</h4>
                        <p>运行时数据存储</p>
                        <ul style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem;">
                            <li>存储运行中的程序</li>
                            <li>临时数据缓存</li>
                            <li>快速读写</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <div class="icon">💾</div>
                        <h4>硬盘</h4>
                        <p>持久化存储</p>
                        <ul style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem;">
                            <li>存储文件系统</li>
                            <li>保存用户数据</li>
                            <li>程序安装位置</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <div class="icon">🌐</div>
                        <h4>网卡</h4>
                        <p>网络通信</p>
                        <ul style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem;">
                            <li>发送/接收数据包</li>
                            <li>网络协议处理</li>
                            <li>连接外部网络</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- 内核层 -->
            <section class="content-section" id="kernel">
                <h2 class="section-title">
                    <span class="icon">⚙️</span>
                    （2）内核层 Kernel
                </h2>

                <div class="info-box">
                    <h4>内核是什么？</h4>
                    <p>内核是操作系统的<strong>核心部分</strong>，负责管理所有硬件资源，并为上层提供统一的服务接口。</p>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>功能模块</th>
                                <th>说明</th>
                                <th>示例系统调用</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>进程/线程调度</strong></td>
                                <td>决定哪个程序运行</td>
                                <td><code>fork()</code>, <code>exec()</code>, <code>wait()</code></td>
                            </tr>
                            <tr>
                                <td><strong>系统调用</strong></td>
                                <td>提供用户程序接口</td>
                                <td><code>read()</code>, <code>write()</code>, <code>open()</code></td>
                            </tr>
                            <tr>
                                <td><strong>虚拟内存管理</strong></td>
                                <td>内存分配、地址映射</td>
                                <td><code>mmap()</code>, <code>brk()</code></td>
                            </tr>
                            <tr>
                                <td><strong>设备驱动</strong></td>
                                <td>硬件管理</td>
                                <td>通过文件接口访问</td>
                            </tr>
                            <tr>
                                <td><strong>文件系统</strong></td>
                                <td>文件读写、组织</td>
                                <td><code>open()</code>, <code>read()</code>, <code>write()</code></td>
                            </tr>
                            <tr>
                                <td><strong>网络通信</strong></td>
                                <td>Socket、协议栈</td>
                                <td><code>socket()</code>, <code>bind()</code>, <code>listen()</code></td>
                            </tr>
                            <tr>
                                <td><strong>进程间通信</strong></td>
                                <td>IPC 机制</td>
                                <td><code>pipe()</code>, <code>shmget()</code>, <code>mq_send()</code></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="diagram-container">
                    <h4>内核模式 vs 用户模式</h4>
                    <div class="card-grid">
                        <div class="feature-card" style="border-color: var(--danger-color);">
                            <div class="icon">🔴</div>
                            <h4>内核模式 (Kernel Mode)</h4>
                            <ul style="color: var(--text-secondary); font-size: 0.9rem;">
                                <li>拥有最高权限</li>
                                <li>可执行特殊 CPU 指令</li>
                                <li>可直接访问硬件</li>
                                <li>⚠️ 错误可能导致系统崩溃</li>
                            </ul>
                        </div>
                        <div class="feature-card" style="border-color: var(--success-color);">
                            <div class="icon">🟢</div>
                            <h4>用户模式 (User Mode)</h4>
                            <ul style="color: var(--text-secondary); font-size: 0.9rem;">
                                <li>普通程序运行环境</li>
                                <li>受保护的内存空间</li>
                                <li>不能直接访问硬件</li>
                                <li>通过系统调用请求服务</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span>系统调用示例</span>
                        <button class="copy-btn">复制</button>
                    </div>
                    <pre><code>// 用户程序调用 write
write(fd, "Hello", 5);
    ↓
// 通过 glibc 封装
// 触发软中断，切换到内核模式
    ↓
// 内核执行实际的写操作
// 返回用户模式</code></pre>
                </div>
            </section>

            <!-- 系统库层 -->
            <section class="content-section" id="library">
                <h2 class="section-title">
                    <span class="icon">📚</span>
                    （3）系统库层
                </h2>

                <div class="info-box">
                    <h4>库层的作用</h4>
                    <p>封装系统调用，提供更友好的接口；处理跨平台兼容性；提供常用功能。</p>
                </div>

                <div class="card-grid">
                    <div class="feature-card">
                        <div class="icon">📖</div>
                        <h4>glibc</h4>
                        <p>GNU C 库，Linux 标准 C 库，提供标准 C 函数和系统调用封装</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">🧵</div>
                        <h4>libpthread</h4>
                        <p>POSIX 线程库，提供多线程编程支持</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">🔢</div>
                        <h4>libm</h4>
                        <p>数学库，提供数学运算函数</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">🔗</div>
                        <h4>动态链接库</h4>
                        <p>.so 文件，运行时加载，节省内存</p>
                    </div>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span>库函数 vs 系统调用</span>
                        <button class="copy-btn">复制</button>
                    </div>
                    <pre><code>// 系统调用（底层）
int fd = open("file.txt", O_RDONLY);

// 库函数（封装）
FILE *fp = fopen("file.txt", "r");
// fopen 内部调用 open，并添加缓冲等功能

// 库函数的优势：
// 1. 跨平台兼容
// 2. 更友好的接口
// 3. 额外功能（如缓冲）</code></pre>
                </div>
            </section>

            <!-- 应用层 -->
            <section class="content-section" id="application">
                <h2 class="section-title">
                    <span class="icon">🖥️</span>
                    （4）应用层
                </h2>

                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    应用层是用户直接接触的层面，包括所有用户运行的程序。
                </p>

                <div class="card-grid">
                    <div class="feature-card">
                        <div class="icon">🖥️</div>
                        <h4>Shell 命令</h4>
                        <p>ls, cd, grep, cat 等命令行工具</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">🪟</div>
                        <h4>桌面应用</h4>
                        <p>浏览器、编辑器、播放器等</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">🖥️</div>
                        <h4>服务程序</h4>
                        <p>Web 服务器、数据库、SSH 等</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">📝</div>
                        <h4>你的程序</h4>
                        <p>自己编写的 C 程序</p>
                    </div>
                </div>

                <div class="diagram-container">
                    <h4>Shell 命令执行流程</h4>
                    <div class="flow-diagram">
                        <div class="flow-step">
                            <span class="num">1</span>
                            <div>用户输入</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">ls -la</div>
                        </div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-step">
                            <span class="num">2</span>
                            <div>Shell 解析</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">查找 PATH</div>
                        </div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-step">
                            <span class="num">3</span>
                            <div>fork()</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">创建子进程</div>
                        </div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-step">
                            <span class="num">4</span>
                            <div>exec()</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">加载程序</div>
                        </div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-step highlight">
                            <span class="num">5</span>
                            <div>执行输出</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">显示结果</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 通信方式总结 -->
            <section class="content-section" id="communication">
                <h2 class="section-title">
                    <span class="icon">🔄</span>
                    层间通信方式
                </h2>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>从</th>
                                <th>到</th>
                                <th>通信方式</th>
                                <th>示例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>应用层</td>
                                <td>库层</td>
                                <td>函数调用</td>
                                <td><code>fopen()</code>, <code>printf()</code></td>
                            </tr>
                            <tr>
                                <td>库层</td>
                                <td>内核层</td>
                                <td>系统调用</td>
                                <td><code>open()</code>, <code>read()</code></td>
                            </tr>
                            <tr>
                                <td>内核层</td>
                                <td>硬件层</td>
                                <td>硬件指令/驱动</td>
                                <td>端口 I/O, 内存映射</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 完成按钮 -->
            <div class="completion-section" style="text-align: center; margin: 3rem 0; padding: 2rem; background: var(--bg-secondary); border-radius: var(--radius-xl);">
                <h3 style="margin-bottom: 1rem;">🎉 完成本模块学习？</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">点击按钮保存学习进度</p>
                <button onclick="markCompleted('architecture')" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; border: none; padding: 1rem 2rem; border-radius: var(--radius-lg); font-size: 1rem; font-weight: 600; cursor: pointer;">
                    ✓ 标记为已完成
                </button>
            </div>

            <!-- 导航按钮 -->
            <div class="nav-buttons">
                <a href="linux-env.html" class="nav-btn">
                    ← 上一章：Linux 环境
                </a>
                <a href="c-programming.html" class="nav-btn next">
                    下一章：C 语言 →
                </a>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>Linux 系统编程学习指南</p>
    </footer>

    <script src="../js/main.js"></script>
</body>
</html>
